<!DOCTYPE HTML>

<html lang="pl">

<head>
    <meta charset="utf-8">
    <title>Attack of the Clones</title>
    <meta name="description" content="slider with pure js">
    <meta name="author" content="Mariusz Najwer">
    <script src="https://kit.fontawesome.com/084a192b8b.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
</head>

<body>
    <div id="clones">
        <h1>Attack of the Clones</h1>
        <div id="counter">
            <p>Number of Clones</p>
            <input id="howManyClonesOnPage" value=1>
        </div>
        <div id="counterNext">
            <p>Number of Clones Next</p>
            <input id="howMayClones" value=1>
        </div>
        <div id="stormtrooper[0]">
            <p id="stormtrooper-name[0]">Name 0</p>
            <input id="stormtrooper-name-input[0]">
            <button id="stormtroope-remove[0]">Remove</button>
        </div>
    </div>
    <button id="stormtroope-add">Add</button>
</body>
<!-- https://javascript.info/modifying-document -->
<script>
    init();

    function init() {
        document.getElementById("stormtroope-remove[0]").style.display = "none";
        document.getElementById("stormtroope-remove[0]").addEventListener("click", removeElementHTML);
        document.getElementById("stormtrooper-name-input[0]").addEventListener('change', check)
        document.getElementById("howMayClones").addEventListener('change', addManyClones)

        document.getElementById("stormtroope-add").addEventListener("click", cloneElementHTML);
    }

    function addManyClones() {
        let clonesOnPage = document.getElementById("howManyClonesOnPage").value;
        let clonesOnPageAfter = Number(document.getElementById("howMayClones").value) - Number(clonesOnPage);

        if (Number(document.getElementById("howMayClones").value) < 1)
            return;
        
        if (clonesOnPageAfter > 0) {
            console.log("Dodaje klony")
            for (let i = 0; i < clonesOnPageAfter; i++)
                cloneElementHTML()
        } else if (clonesOnPageAfter < 0) {
            console.log(clonesOnPageAfter)
            console.log("Trzeba usunac")
        }
            
    }

    function changeCloneId(element, newId) {
        element.id = element.id.replace("0", "" + newId + "")
        element.querySelectorAll("[id^='stormtroope']").forEach(v => {
            str = v.id.substring( v.id.lastIndexOf("[")+1, v.id.lastIndexOf("]"))
            v.id = v.id.replace(str, newId)
            v.innerHTML = v.innerHTML.replace("0", (newId))
        })
        element.querySelectorAll("input").forEach(v => {
            v.value = ''
            v.addEventListener('change', check)
        })
    }

    function cloneElementHTML () {
        let original = document.getElementById("stormtrooper[0]")
        let origin = document.getElementById("clones")
        let clonesOnPage = document.getElementById("howManyClonesOnPage").value++;

        let clone = original.cloneNode(true);
        changeCloneId (clone, clonesOnPage)
        origin.append(clone);

        origin.querySelectorAll("[id^='stormtroope-remove']").forEach(v => {
            v.style.display = "inline-block"
            v.addEventListener("click", removeElementHTML);
        })
    }

    function removeElementHTML() {
        idToRemove = this.id.substring(this.id.lastIndexOf("[") + 1, this.id.lastIndexOf("]"))
        var el = document.getElementById("stormtrooper["+idToRemove+"]");
        let clonesOnPage = document.getElementById("howManyClonesOnPage").value--;
        el.remove()
        for (let i = Number(idToRemove)+1; i < clonesOnPage; i++) {
            console.log(i)
            el = document.getElementById("stormtrooper[" + i + "]");
            el.id = el.id.replace(i.toString(), (i-1).toString())
        }
    }

    function check() {
       console.log(this.id)
    }

</script>

</html>